# This is a working example.
# For a more complete reference use `--example`
kibot:
  version: 1

outputs:

# JLCPCB Fabrication Files
- name: jlcpcb_gbr
  comment: Gerbers compatible with JLCPCB
  type: gerber
  dir: output/fabrication/jlcpcb/gerbers
  options: &gerber_options
    exclude_edge_layer: true
    exclude_pads_from_silkscreen: true
    plot_sheet_reference: false
    plot_footprint_refs: true
    plot_footprint_values: false
    force_plot_invisible_refs_vals: false
    tent_vias: true
    use_protel_extensions: true
    create_gerber_job_file: false
    disable_aperture_macros: true
    gerber_precision: 4.6
    use_gerber_x2_attributes: false
    use_gerber_net_attributes: false
    line_width: 0.1
    subtract_mask_from_silk: true
  layers:
    # Note: a more generic approach is to use 'copper' but then the filenames
    # are slightly different.
    - F.Cu
    - B.Cu
    - F.Paste
    - B.Paste
    - F.SilkS
    - B.SilkS
    - F.Mask
    - B.Mask
    - Edge.Cuts

- name: jlcpcb_drl
  comment: Drill files compatible with JLCPCB
  type: excellon
  dir: output/fabrication/jlcpcb/gerbers
  options:
    pth_and_npth_single_file: false
    pth_id: "-PTH"
    npth_id: "-NPTH"
    metric_units: false
    output: "%f%i.%x"

- name: jlcpcb_zip
  comment: ZIP file for JLCPCB
  type: compress
  dir: output/fabrication/jlcpcb
  options:
    output: "%f_gerber_jlcpcb.%x"
    files:
      - from_output: jlcpcb_gbr
        dest: /
      - from_output: jlcpcb_drl
        dest: /

- name: jlcpcb_cpl
  comment: "Pick and place file, JLCPCB style"
  type: position
  dir: output/fabrication/jlcpcb
  options:
    pre_transform: _rot_footprint_jlcpcb
    output: "%f_cpl_jlcpcb.%x"
    format: CSV
    units: millimeters
    separate_files_for_front_and_back: false
    only_smd: true
    columns:
      - id: Ref
        name: Designator
      - Val
      - Package
      - id: PosX
        name: "Mid X"
      - id: PosY
        name: "Mid Y"
      - id: Rot
        name: Rotation
      - id: Side
        name: Layer

- name: jlcpcb_bom
  comment: "BOM for JLCPCB"
  type: bom
  dir: output/fabrication/jlcpcb
  options:
    output: "%f_%i_jlcpcb.%x"
    ref_separator: ","
    columns:
      - field: Value
        name: Comment
      - field: References
        name: Designator
      - Footprint
      - field: "LCSC"
        name: "LCSC part number"
      - field: "Quantity Per PCB"
        name: "QTY"
    csv:
      hide_pcb_info: true
      hide_stats_info: true
      quote_all: true

# Interactive HTML BOM
- name: ibom
  comment: Interactive HTML BOM
  type: ibom
  dir: output/fabrication/ibom
  options:
    dark_mode: true
    name_format: "index"

# Export PCB images
- name: pcbdraw_png_top
  comment: PCB 2D render in PNG format
  type: pcbdraw
  dir: output/img
  options:
    output: '%f-%i.%x'
    style: set-black-enig
    format: png
    bottom: false
- name: pcbdraw_png_bottom
  comment: PCB 2D render in PNG format
  type: pcbdraw
  dir: output/img
  options:
    output: '%f-%i.%x'
    style: set-black-enig
    format: png
    bottom: true
- name: pcbdraw_svg_top
  comment: PCB 2D render in SVG format
  type: pcbdraw
  dir: output/img
  options:
    output: '%f-%i.%x'
    style: set-black-enig
    format: svg
    bottom: false
- name: pcbdraw_svg_bottom
  comment: PCB 2D render in SVG format
  type: pcbdraw
  dir: output/img
  options:
    output: '%f-%i.%x'
    style: set-black-enig
    format: svg
    bottom: true

# Export schematics as PDF
- name: "schematics_pdf"
  comment: "Print schematics PDF"
  type: pdf_sch_print
  dir: output/schematics
  options:
    color_theme: dracula
    background_color: false

# - name: basic_kiri
#   comment: Interactive diff between commits
#   type: kiri
#   dir: Output/diffa
#   layers:
#   - layer: F.Cu
#     suffix: F_Cu
#     description: Front copper
#   - layer: B.Cu
#     suffix: B_Cu
#     description: Bottom copper
#   - layer: B.Paste
#     suffix: B_Paste
#     description: Bottom solder paste
#   - layer: F.Paste
#     suffix: F_Paste
#     description: Front solder paste
#   - layer: B.Silkscreen
#     suffix: B_Silkscreen
#     description: Bottom silkscreen (artwork)
#   - layer: F.Silkscreen
#     suffix: F_Silkscreen
#     description: Front silkscreen (artwork)
#   - layer: B.Mask
#     suffix: B_Mask
#     description: Bottom soldermask (negative)
#   - layer: F.Mask
#     suffix: F_Mask
#     description: Front soldermask (negative)
#   - layer: User.Drawings
#     suffix: User_Drawings
#     description: User drawings
#   - layer: Edge.Cuts
#     suffix: Edge_Cuts
#     description: Board shape
#   - layer: B.Courtyard
#     suffix: B_Courtyard
#     description: Bottom courtyard area
#   - layer: F.Courtyard
#     suffix: F_Courtyard
#     description: Front courtyard area
#   - layer: B.Fab
#     suffix: B_Fab
#     description: Bottom documentation
#   - layer: F.Fab
#     suffix: F_Fab
#     description: Front documentation
#   options:
#     max_commits: 4

# - name: basic_navigate_results
#   comment: Web page to browse the results
#   type: navigate_results
#   dir: output/browse
#   options:
#     skip_not_run: true

# See: https://sschueller.github.io/posts/ci-cd-with-kicad-and-gitlab/#kibot
